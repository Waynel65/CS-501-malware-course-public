#include <windows.h>
#include <stdio.h>

#define MIN_STR_LEN 4

// FindStr takes a buffer cwith the loaded file, and its size
// It then prints all null terminiated ASCII range strings
void FindString(char* buffer, DWORD bufferSize){
    char asciiMin = 32;
    char asciiMax = 126;
    // //your solution here!
    
    char* charStart;
    char flag = 0;
    // char str[0];
    for(int i = 0; i < bufferSize;i++)
    {
        if(*buffer == 0 && flag == 1)
        {   
            if(buffer - charStart >= 4)
            {
                printf("<string>%s</string>\n", charStart);
            }
            flag = 0;

        }

        if(*buffer >= asciiMin && *buffer <= asciiMax)
        {
            // strncat(str, buffer, 4);
            // printf("<string>%s</string>\n", buffer);
            if(!flag)
            {
                charStart = buffer;
                flag = 1;
            }
        }
        else{
            flag = 0;
        }


        // flag = 0;
        buffer++;
    }
    // printf("Appended String: %s\n", str);
}

// Loads The file contents, calculates the size, then calls FindStr
void MyStrings (char * fileName){
    //GetFileSize
    DWORD fileSize;
    char* buffer;
    
    // //your solution here!
    FILE *fp;
    fp = fopen(fileName, "rb");
    if(fp == NULL)
    {
        printf("File does not exist\n");
    }

    fseek(fp, 0, SEEK_END);
    fileSize = ftell(fp);
    fseek(fp, 0, SEEK_SET);

    buffer = (char*) malloc(fileSize);
    fread(buffer, fileSize, 1, fp);
    // printf("%d\n", fileSize);
    // printf("pointer is at %x and filesize is %x", buffer, fileSize);
    fclose(fp);
    // printf("sum is %x\n", buffer+fileSize);

    FindString(buffer, fileSize);
    // free(buffer);

}

int main(int argc, char* argv[]){
    if(argc != 2){
        printf("Usage: %s <filename>\n", argv[0]);
        return 0;
    }
    MyStrings(argv[1]);
 
}