import datetime
import time
import json
import pefile


# date_time = datetime.datetime(2022,2,21,21,42,34)
# print("unix_timestamp => ",
#       (time.mktime(date_time.timetuple())))

def get_imphash(filepath):
    pe = pefile.PE(filepath)
    imphash = pe.get_imphash()

    pe_import_dict = {}
    # walk the Imports
    for entry in pe.DIRECTORY_ENTRY_IMPORT:
        dll_name = entry.dll.decode('utf-8')
        pe_import_dict[dll_name] = []
        for func in entry.imports:
            pe_import_dict[dll_name] += [func.name.decode('utf-8')]

		
    return imphash, pe_import_dict

imphash, pe_import_dict = get_imphash("FreeCandy.exe")
print(imphash)
print(json.dumps(pe_import_dict, indent=4, sort_keys=True))