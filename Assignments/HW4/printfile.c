#include <windows.h>
#include <stdio.h>
// #include "printfile.h"

//TODO: test this in a c file

BOOL PrintFileContents(char* filename)
{ 
    // filename = a valid null terminated C string
    HANDLE hFile;
    DWORD dwFileSize;
    char *readBuffer;
    BOOL readSuccess;
    // DWORD numBytesRead;
    OVERLAPPED numBytesRead = {0};
    // DWORD error = GetLastError();

    hFile = CreateFileA(filename, GENERIC_READ, FILE_SHARE_READ,
                        NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL | FILE_FLAG_OVERLAPPED,
                        NULL);
    
    if (hFile == INVALID_HANDLE_VALUE)
    {
        printf("unable to open the file!");
        return FALSE;
    }

    dwFileSize = GetFileSize(hFile,NULL);
    readBuffer = (char*)malloc((dwFileSize+1)*sizeof(char)); // +1 for null-terminating character
    if (readBuffer == NULL)
    {
        printf("memory allocation failed\n");
    }

    readSuccess = ReadFileEx(hFile, readBuffer, dwFileSize+1, &numBytesRead, NULL);
    
    if (!readSuccess)
    {
        printf("unable to read content of file\n");
        CloseHandle(hFile);
        return FALSE;
    }

    printf("%s", readBuffer);
    CloseHandle(hFile);
    free(readBuffer);
    return TRUE;

}

// int main(int argc, char* argv[]){
//     char* filename = argv[1];

//     PrintFileContents(filename);
// }
